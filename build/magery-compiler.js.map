{"version":3,"sources":["webpack:///webpack/bootstrap 6a3da419c952d9849e43","webpack:///./src/magery-compiler.js","webpack:///./src/compile.js","webpack:///./src/utils.js","webpack:///./src/html.js"],"names":[],"mappings":";;AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;ACtCA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACbA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL,cAAa,0BAA0B;AACvC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAmB;AACnB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAuB;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAgC;AAChC;AACA;AACA;AACA,yEAAwE;AACxE;AACA;AACA;AACA,0EAAyE;AACzE;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA8B,gCAAgC;AAC9D,kEAAiE,OAAO;AACxE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA8B,gCAAgC;AAC9D,kEAAiE,OAAO;AACxE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mGAAkG;AAClG;AACA;AACA,kFAAiF;AACjF;AACA;AACA;AACA;AACA;AACA,8EAA6E;AAC7E;AACA;AACA,kEAAiE;AACjE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4EAA2E;AAC3E;AACA;AACA,oFAAmF;AACnF,4EAA2E;AAC3E,6BAA4B;AAC5B;AACA;AACA;AACA;AACA;AACA,0DAAyD;AACzD;AACA,UAAS;AACT;AACA;AACA;AACA,sCAAqC,eAAe,EAAE;AACtD;AACA;AACA;AACA;AACA,MAAK;AACL;AACA,4BAA2B;AAC3B;AACA;AACA;AACA,iBAAgB,GAAG;AACnB;AACA;AACA,iBAAgB;AAChB;AACA;AACA,iBAAgB;AAChB;AACA;AACA,iBAAgB,EAAE;AAClB;AACA;;AAEA;AACA,8BAA6B,SAAS;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,kDAAiD;AACjD;AACA;AACA,oCAAmC;AACnC;AACA;;AAEA;AACA;AACA;AACA,MAAK;AACL;;AAEA;AACA;AACA,yDAAwD;AACxD,sCAAqC;AACrC,0DAAyD;AACzD;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,wCAAuC,SAAS;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4EAA2E;AAC3E,qCAAoC;AACpC;AACA,iBAAgB;AAChB;AACA,aAAY;AACZ;;AAEA;AACA,uCAAsC;AACtC;AACA;AACA,MAAK;AACL,uBAAsB;AACtB;;;;;;;AC7SA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAK;AACL;;AAEA;AACA;AACA;AACA,uCAAsC,SAAS;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA8B;AAC9B;;AAEA;AACA;AACA,kDAAiD,SAAS;AAC1D;AACA;AACA;;;;;;;AC7EA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"magery-compiler.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 6a3da419c952d9849e43","exports.compileToString = require('./compile').compileToString;\n\nexports.compile = function (target, templates, runtime) {\n    runtime = runtime || window.Magery;\n    templates = templates || {};\n    if (typeof(target) === 'string') {\n        return exports.compile(document.querySelectorAll(target), templates, runtime);\n    }\n    var compiled = eval(exports.compileToString(target))(runtime);\n    for (var k in compiled) {\n        templates[k] = compiled[k];\n    }\n    return templates;\n};\n\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/magery-compiler.js\n// module id = 0\n// module chunks = 0","var utils = require('./utils');\nvar html = require('./html');\n\n\nvar IGNORED_ATTRS = [\n    'data-tagname',\n    'data-each',\n    'data-if',\n    'data-unless',\n    'data-key'\n];\n\nfunction compileLookup(path) {\n    return 'p.lookup(data, ' + JSON.stringify(path) + ')';\n}\n\nfunction compileTemplateContext(node) {\n    var result = [];\n    utils.eachAttribute(node, function (name, value) {\n        if (IGNORED_ATTRS.indexOf(name) === -1 && name.substr(0, 2) !== 'on') {\n            result.push(\n                JSON.stringify(name) + \": \" + compileExpandVariables(value)\n            );\n        }\n    });\n    return '{' + result.join(', ') + '}';\n}\n\nfunction compileListener(event_name, value) {\n    var start = value.indexOf('(');\n    var end = value.lastIndexOf(')');\n    var handler_name = value.substring(0, start);\n    var args_raw = value.substring(start + 1, end);\n    return 'p.eventListener(' +\n        JSON.stringify(event_name) + ', ' +\n        JSON.stringify(handler_name.split('.')) + ', ' +\n        JSON.stringify('[' + args_raw + ']') + ', ' +\n        'data, ' +\n        'handlers);\\n';\n}\n\nfunction compileExtraAttrs(node) {\n    var extra_attrs = '';\n    utils.eachAttribute(node, function (name, value) {\n        var event = name.match(/^on(.*)/);\n        if (event) {\n            extra_attrs += compileListener(event[1], value);\n        }\n    });\n    return extra_attrs;\n}\n\n// TODO: split out into compileTemplateCall, compileInner, compileHTMLElement etc. ?\nfunction compileElement(node, queue, write, is_root) {\n    if (node.tagName === 'TEMPLATE-EMBED') {\n        // ignored client-side\n        return;\n    }\n    if (node.tagName === 'TEMPLATE-CHILDREN') {\n        write('inner();\\n');\n        return;\n    }\n    if (!is_root && node.tagName === 'TEMPLATE' && node.getAttribute('data-tagname')) {\n        // compile this template later\n        queue.push(node);\n        return;\n    }\n    if (node.getAttribute('data-each')) {\n        var parts = node.getAttribute('data-each').split(/\\s+in\\s+/);\n        var name = parts[0];\n        var iterable_path = utils.propertyPath(parts[1]);\n        write('p.each(' +\n              'data, ' +\n              JSON.stringify(name) + ', ' +\n              compileLookup(iterable_path) + ', ' +\n              'function (data) {\\n');\n    }\n    if (node.getAttribute('data-if')) {\n        var predicate1_path = utils.propertyPath(node.getAttribute('data-if'));\n        write('if (p.isTruthy(' + compileLookup(predicate1_path) + ')) {\\n');\n    }\n    if (node.getAttribute('data-unless')) {\n        var predicate2_path = utils.propertyPath(node.getAttribute('data-unless'));\n        write('if (!p.isTruthy(' + compileLookup(predicate2_path) + ')) {\\n');\n    }\n    var children = (node.tagName == 'TEMPLATE' && node.content) ?\n            node.content.childNodes:\n            node.childNodes;\n\n    var is_html = true;\n    if (node.tagName == 'TEMPLATE-CALL') {\n        // not a known HTML tag, assume template reference\n        write('p.render(' +\n              'templates' +\n              ', ' + compileExpandVariables(node.getAttribute('template')) +\n              ', ' + compileTemplateContext(node) +\n              ', handlers' +\n              ', ' + (node.getAttribute('data-key') ? compileExpandVariables(node.getAttribute('data-key')) : 'null') +\n              ', function () {' + compileExtraAttrs(node) + '}' +\n              (children.length ? ', p.wrapChildren(function (p) {' : ');') + '\\n');\n        is_html = false;\n    }\n    else if (node.tagName.indexOf('-') !== -1) {\n        // not a known HTML tag, assume template reference\n        write('p.render(' +\n              'templates' +\n              ', ' + JSON.stringify(node.tagName.toLowerCase()) +\n              ', ' + compileTemplateContext(node) +\n              ', handlers' +\n              ', ' + (node.getAttribute('data-key') ? compileExpandVariables(node.getAttribute('data-key')) : 'null') +\n              ', function () {' + compileExtraAttrs(node) + '}' +\n              (children.length ? ', p.wrapChildren(function (p) {' : ');') + '\\n');\n        is_html = false;\n    }\n    else {\n        var tag = node.tagName;\n        if (tag === 'TEMPLATE' && node.getAttribute('data-tagname')) {\n            tag = node.getAttribute('data-tagname').toUpperCase();\n        }\n        if (is_root) {\n            // check if a key was passed into this template by caller\n            if (node.getAttribute('data-key')) {\n                write('p.enterTag(' +\n                      JSON.stringify(tag) + ', ' +\n                      'root_key || ' + compileExpandVariables(node.getAttribute('data-key')) + ');\\n');\n            }\n            else {\n                write('p.enterTag(' + JSON.stringify(tag) + ', root_key || null);\\n');\n            }\n        }\n        else if (node.getAttribute('data-key')) {\n            write('p.enterTag(' +\n                  JSON.stringify(tag) + ', ' +\n                  compileExpandVariables(node.getAttribute('data-key')) + ');\\n');\n        }\n        else {\n            write('p.enterTag(' + JSON.stringify(tag) + ', null);\\n');\n        }\n        utils.eachAttribute(node, function (name, value) {\n            if (name === 'data-template') {\n                name = 'data-bind';\n            }\n            if (IGNORED_ATTRS.indexOf(name) !== -1) {\n                return;\n            }\n            var event = name.match(/^on(.*)/);\n            if (event) {\n                write(compileListener(event[1], value));\n            }\n            else if (html.attributes[name] & html.BOOLEAN_ATTRIBUTE) {\n                if (value === \"\") {\n                    // empty boolean attribute is always true\n                    write('p.attribute(' + JSON.stringify(name) + ', true);\\n');\n                }\n                else {\n                    write('if (p.isTruthy(' + compileExpandVariables(value) + ')) {\\n');\n                    write('p.attribute(' + JSON.stringify(name) + ', true);\\n');\n                    write('}\\n');\n                }\n            }\n            else {\n                write('p.attribute(' +\n                      JSON.stringify(name) + ', ' +\n                      compileExpandVariables(value) + ');\\n');\n            }\n        });\n        if (is_root) {\n            // expand any extra attributes passed into template call\n            // from calling tag (e.g. onchange)\n            write('if (extra_attrs) { extra_attrs(); }\\n');\n        }\n    }\n    utils.eachNode(children, function (node) {\n        compileNode(node, queue, write, false);\n    });\n    if (is_html) {\n        write('p.exitTag();\\n');\n    }\n    else if (children.length) {\n        // end inner function of template call\n        write('}));\\n');\n    }\n    if (node.getAttribute('data-unless')) {\n        write('}\\n');\n    }\n    if (node.getAttribute('data-if')) {\n        write('}\\n');\n    }\n    if (node.getAttribute('data-each')) {\n        write('});\\n');\n    }\n}\n\nfunction compileExpandVariables(str, boolean) {\n    var parts = str.split(/{{\\s*|\\s*}}/);\n    var length = parts.length;\n    var i = -1;\n    while (++i < length) {\n        if (i % 2) {\n            var path = utils.propertyPath(parts[i]);\n            parts[i] = path;\n        }\n    }\n    // presence of empty boolean property is actually truthy\n    if (length == 1 && !parts[0] && boolean) {\n        return 'true';\n    }\n    // otherwise build a result string by expanding nested variables\n    var result_parts = [];\n    var j = -1;\n    while (++j < length) {\n        if (parts[j].length) {\n            result_parts.push(\n                (j % 2) ? compileLookup(parts[j]): JSON.stringify(parts[j])\n            );\n        }\n    }\n    if (!result_parts.length) {\n        return JSON.stringify('');\n    }\n    return result_parts.join(' + ');\n}\n\nfunction compileText(node, write) {\n    var txt = compileExpandVariables(node.textContent);\n    if (txt[0] !== '\"') {\n        // coerce to string\n        txt = '\"\"+' + txt;\n    }\n    if (node.parentNode.tagName === 'TEXTAREA') {\n        // TODO: this could potentially overwrite previous text if its\n        // possible for a textarea to contain multiple text nodes -\n        // however, I've not seen any markup inside a textarea parsed\n        // into separate text nodes yet.\n        \n        // if we're inside a textarea, use the value property instead\n        write('p.attribute(\"value\", ' + txt + ');\\n');\n    }\n    else {\n        write('p.text(' + txt + ');\\n');\n    }\n}\n\nfunction compileDocumentFragment(fragment, queue, write) {\n    utils.eachNode(fragment.childNodes, function (node) {\n        compileNode(node, queue, write, false);\n    });\n}\n\nfunction compileNode(node, queue, write, is_root) {\n    switch (node.nodeType) {\n    case 1: compileElement(node, queue, write, is_root); break;\n    case 3: compileText(node, write); break;\n    case 11: compileDocumentFragment(node, queue, write); break;\n    }\n}\n\nfunction ignore_output(str) {}\n\nexports.compile = function (nodes, write) {\n    var queue = [];\n    if (!(nodes instanceof NodeList)) {\n        nodes = [nodes];\n    }\n    for (var i = 0, len = nodes.length; i < len; i++) {\n        var node = nodes[i];\n        compileNode(\n            node,\n            queue,\n            ignore_output,\n            // if current node is not a template, ignore output until\n            // a template node is found\n            !(node.tagName == 'TEMPLATE' &&\n              node.hasAttribute('data-tagname'))\n        );\n    }\n    write('({\\n');\n    while (queue.length) {\n        node = queue.shift();\n        if (node.getAttribute('data-tagname').indexOf('-') === -1) {\n            throw new Error(\n                \"Error compiling template '\" + node.getAttribute('data-tagname') +\n                    \"': data-tagname must include a hyphen\"\n            );\n        }\n        write(JSON.stringify(node.getAttribute('data-tagname')) + ': ');\n        write('Magery._template(' +\n              'function (p, data, handlers, root_key, extra_attrs, inner) {\\n');\n        write('var templates = this;\\n');\n        compileNode(node, queue, write, true);\n        write('})' + (queue.length ? ',' : '') + '\\n');\n    }\n    write('})\\n');\n};\n\nexports.compileToString = function (node) {\n    var result = '(function (Magery) { return ';\n    exports.compile(node, function (str) {\n        result += str;\n    });\n    return result + '})';\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/compile.js\n// module id = 1\n// module chunks = 0","var ELEMENT_NODE = 1;\nvar TEXT_NODE = 3;\nvar DOCUMENT_FRAGMENT = 11;\n\nexports.isDocumentFragment = function (node) {\n    return node.nodeType === DOCUMENT_FRAGMENT;\n};\n\nexports.isElementNode = function (node) {\n    return node.nodeType === ELEMENT_NODE;\n};\n\nexports.isTextNode = function (node) {\n    return node.nodeType === TEXT_NODE;\n};\n\nexports.eachNode = function (nodelist, f) {\n    var i = 0;\n    var node = nodelist[0];\n    while (node) {\n        var tmp = node;\n        // need to call nextSibling before f() because f()\n        // might remove the node from the DOM\n        node = node.nextSibling;\n        f(tmp, i++, nodelist);\n    }\n};\n\nexports.mapNodes = function (nodelist, f) {\n    var results = [];\n    exports.eachNode(nodelist, function (node, i) {\n        results[i] = f(node, i, nodelist);\n    });\n    return results;\n};\n\nexports.trim = function (str) {\n    return str.replace(/^\\s+|\\s+$/g, '');\n};\n\nexports.propertyPath = function (str) {\n    return str.split('.').filter(function (x) {\n        return x;\n    });\n};\n\n// finds property path array (e.g. ['foo', 'bar']) in data object\nexports.lookup = function (data, props) {\n    var value = data;\n    for(var i = 0, len = props.length; i < len; i++) {\n        if (value === undefined || value === null) {\n            return '';\n        }\n        value = value[props[i]];\n    }\n    return (value === undefined || value === null) ? '' : value;\n};\n\nexports.templateTagName = function (node) {\n    var m = /^TEMPLATE-([^\\s/>]+)/.exec(node.tagName);\n    return m && m[1].toLowerCase();\n};\n\nexports.shallowClone = function (obj) {\n    var result = {};\n    for (var k in obj) {\n        result[k] = obj[k];\n    }\n    return result;\n    // return Object.assign({}, obj);\n};\n\nexports.eachAttribute = function (node, f) {\n    var attrs = node.attributes;\n    for (var i = 0, len = node.attributes.length; i < len; i++) {\n        f(node.attributes[i].name, node.attributes[i].value);\n    }\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/utils.js\n// module id = 2\n// module chunks = 0","var BOOLEAN_ATTRIBUTE = exports.BOOLEAN_ATTRIBUTE = 1;\nvar USE_PROPERTY = exports.USE_PROPERTY = 2;\nvar USE_STRING = exports.USE_STRING = 4;\n\nexports.attributes = {\n    'allowfullscreen': BOOLEAN_ATTRIBUTE,\n    'async': BOOLEAN_ATTRIBUTE,\n    'autofocus': BOOLEAN_ATTRIBUTE,\n    'autoplay': BOOLEAN_ATTRIBUTE,\n    'capture': BOOLEAN_ATTRIBUTE,\n    'checked': BOOLEAN_ATTRIBUTE | USE_PROPERTY,\n    'controls': BOOLEAN_ATTRIBUTE,\n    'default': BOOLEAN_ATTRIBUTE,\n    'defer': BOOLEAN_ATTRIBUTE,\n    'disabled': BOOLEAN_ATTRIBUTE,\n    'formnovalidate': BOOLEAN_ATTRIBUTE,\n    'hidden': BOOLEAN_ATTRIBUTE,\n    'itemscope': BOOLEAN_ATTRIBUTE,\n    'loop': BOOLEAN_ATTRIBUTE,\n    'multiple': BOOLEAN_ATTRIBUTE | USE_PROPERTY,\n    'muted': BOOLEAN_ATTRIBUTE | USE_PROPERTY,\n    'novalidate': BOOLEAN_ATTRIBUTE,\n    'open': BOOLEAN_ATTRIBUTE,\n    'readonly': BOOLEAN_ATTRIBUTE,\n    'required': BOOLEAN_ATTRIBUTE,\n    'reversed': BOOLEAN_ATTRIBUTE,\n    'selected': BOOLEAN_ATTRIBUTE | USE_PROPERTY,\n    'value': USE_PROPERTY | USE_STRING\n};\n\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/html.js\n// module id = 3\n// module chunks = 0"],"sourceRoot":""}